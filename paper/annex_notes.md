# Annex notes

You can also view the full working table of Topics and relevance to our report [here](https://www.notion.so/EUDI-ARF-Annex-2-Review-215cca33026080a58f13e4c1b31cb240)

## Important links:

- EUDI ARF Annex 2: https://eu-digital-identity-wallet.github.io/eudi-doc-architecture-and-reference-framework/1.4.0/annexes/annex-2/annex-2-high-level-requirements/
- EUDI technical specifications: https://github.com/eu-digital-identity-wallet/eudi-doc-standards-and-technical-specifications/blob/main/docs/technical-specifications/ts1-eudi-wallet-trust-mark.md

## Relevant Vocab:

_See full list of definitions [here]_(https://eu-digital-identity-wallet.github.io/eudi-doc-architecture-and-reference-framework/1.1.0/arf/#2-definitions)

- **Relying Party** - verifier
- **Wallet Holder / User** - prover
- **EUDI Attribute Authority (EAA)** - issuer
- **OpenID4VP** - remote flow where user probes verifier, which then has to probe a remote wallet; see full standard [here](https://openid.net/specs/openid-4-verifiable-presentations-1_0.html)
- **QEAA** - document containing attestations (e.g. diplomas, student IDs, etc), slightly diff from PID in scope but same technically
- **Proximity flow** - ID verification over e.g. NFC tap rather than over a remote network connection
- **Wallet Instance Attestation (WIA)** - wallet provider's certificate to a wallet instance (to manage revocation)

## Main POC implementation notes:

- Has to support attestation in mDL standard [ISO18013-5] (CBOR data) and SD-JWT (JSON) formats
- Has to support presentation flows as as defined in mDL standard [ISO18013-5] and OpenID4VP standard for verifiable credentials

## Potential additional directions for POC:

Data minimization:

- PID Provider Trusted List (required) (Topic 1, Requirement OIA_12) -- theoretically can make issuer private (with e.g. Merkle inclusion proof). this is useful if the issuer has not issued many credentials, or the knowledge of the issuer itself provides a lot of information.
-

Unlinkability:

- Private proof-of-non-revocation flow (proposal) (Topic 7 and 38) -- public Merkle-tree registry of valid public keys / WIAs (latter preferred, since a list of public keys leaks / makes identity linkable from inspecting the device-binding signatures) for non-revoked/non-suspended credentials that issuer maintains, user provides proof (of ownership of a signed WIA) using Merkle inclusion proofs
- Private proof-of-assocation (proposal) (Topic 18) -- include verification of proof-of-association received from the WSCA/WSCD for credentials issued to different public keys controlled by secure device within the zkSNARK
- Private client-side in-circuit verification of WTE (proposal) (Topic 35) -- to prevent linking across user-issuer interactions, especially if issuers can be verifiers or other wallet users

Custom linkability:

- Self-maintained pseudonyms (proposal) (Topic 11) -- the pseudonym is a public nullifier output of the zkSNARK = hash(pk, random_salt), to eliminate need for an external pseudonym provider and allow for multiple pseudonyms controlled by the user

## Annex 2 Requirements Review

| Topic | Summary                                                                                                                                                                                    | Comments                                                                                                                                                          | Paper Scope? | Paper Notes                                                                                                                                                                                                                                                                                                                     | Privacy Concerns? | Privacy Notes                                                                                                                                                                                                                                                                                                          |
| ----- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1     | device binding + remote flows, according to [OpenID4VP] standard                                                                                                                           | some of the points (e.g. verifying relying party identity, UX flows for which credential to present) are not strictly covered within our flow                     | Yes          | _ device binding: we propose that WSCA signature of nonce should be checked against pk of credential PRIVATELY in-circuit (otherwise reveals pk → linkability)<br>_ relying party verifying PID/QEAA signatures from trust list: can check issuer pk from list while hiding issuer signature check PRIVATELY in-circuit         | Yes               | \* we would propose merkle inclusion proof to hide the specific issuer pk (in case that issuer has only issued a few credentials), but would rely on external trusted maintenance/agreement of the merkle tree. this may not strictly align with "validate signature using trust list".                                |
| 2     | wallet must support mDLs                                                                                                                                                                   |                                                                                                                                                                   | Yes          | _ must support mDLs (specified in [ISO/IEC 18013-5])<br>_ https://github.com/microsoft/crescent-credentials already supports mDLs CBOR parsing                                                                                                                                                                                  | Maybe             |                                                                                                                                                                                                                                                                                                                        |
| 3     | PID rulebook (see https://eu-digital-identity-wallet.github.io/eudi-doc-architecture-and-reference-framework/1.4.0/annexes/annex-3/annex-3.01-pid-rulebook/)                               | issuer responsibility                                                                                                                                             | No           |                                                                                                                                                                                                                                                                                                                                 | No                |                                                                                                                                                                                                                                                                                                                        |
| 4     | mDL rulebook (see https://eu-digital-identity-wallet.github.io/eudi-doc-architecture-and-reference-framework/latest/annexes/annex-3/annex-3.02-mDL-rulebook/)                              | issuer responsibility                                                                                                                                             | No           |                                                                                                                                                                                                                                                                                                                                 | No                |                                                                                                                                                                                                                                                                                                                        |
| 5     | EUDI wallet design                                                                                                                                                                         | no HLRs                                                                                                                                                           | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 6     | relying party authentication                                                                                                                                                               | user checks relying party ID / certificates, e.g. signature checks                                                                                                | No           |                                                                                                                                                                                                                                                                                                                                 |                   |                                                                                                                                                                                                                                                                                                                        |
| 7     | only issuers can revoke, using an "attestation status / revocation list mechanism", that relying parties also use                                                                          | \* either short term credentials, have an attestation status (e.g. suspension) list mechanism, or attestation revocation list mechanism                           | Maybe        | _ prover needs to provide some kind of proof of non-revocation<br>_ we propose providing merkle inclusion proof of a public online list                                                                                                                                                                                         | Yes               | \* without attestation lists being public, would either i) need to phone home to issuer to see the status of credential/obtain a proof → issuer surveillance, or ii) provide an ID the relying party can check against a public list → linkability                                                                     |
| 8     | N/A                                                                                                                                                                                        | no HLRs                                                                                                                                                           | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 9     | wallet provider provides WTE certificate to wallet instances (testifying security of WSCA/D), wallet gives new PK + proof-of-association with WTE key to issuers to receive credentials to | wallet provider responsibility, WTE is never shown to relying parties (see Topic 18 for proof-of-association sent to relying parties)                             | No           |                                                                                                                                                                                                                                                                                                                                 | Yes               | \* potential issuer collusion allows for reconstruction of a superset of IDs if WTE is provided in plain. proof of association with keys should also be private/in-circuit if possible                                                                                                                                 |
| 10    | _ wallets must support proximity and remote [OpenID4VP] flows<br>_ wallets must support mDLs and SD-JWTs<br>\* UX flow around user accepting newly issued PID/attestation                  |                                                                                                                                                                   | Yes          | _ again must support mDLs (specified in [ISO/IEC 18013-5])<br>_ https://github.com/microsoft/crescent-credentials already supports mDLs CBOR parsing                                                                                                                                                                            |                   |                                                                                                                                                                                                                                                                                                                        |
| 11    | _ pseudonyms issued by a pseudonym provider<br>_ allows relying party to recognize users across presentations                                                                              |                                                                                                                                                                   | Yes          | \* to eliminate need for an external pseudonym provider + allow for multiple pseudonyms controlled by the user: we propose computing/outputting a deterministic nullifier hash H(public_key, random_salt) (where the wallet stores the random_salt) in-circuit, to use as the pseudonym                                         | Yes               | _ if pseudonym provider is issuer, this is really bad (can track full identity whenever issuer-assigned pseudonym used)<br>_ if pseudonym provider is an external party, perhaps need some kindof id disclosure to get a pseudonym → similar to issuer tracking                                                        |
| 12    | \* should standardize attribute identifiers/syntaxes across namespaces and attestation types for max interoperability                                                                      | issuer responsibility / for verifier request convenience. but also somewhat for user legibility/transparency                                                      | No           |                                                                                                                                                                                                                                                                                                                                 | No                |                                                                                                                                                                                                                                                                                                                        |
| 13    |                                                                                                                                                                                            | no HLRs                                                                                                                                                           | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 14    |                                                                                                                                                                                            | no HLRs                                                                                                                                                           | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 15    |                                                                                                                                                                                            | no HLRs                                                                                                                                                           | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 16    | \* wallet should allow user to create (qualified electronic) signatures over documents                                                                                                     |                                                                                                                                                                   | No           |                                                                                                                                                                                                                                                                                                                                 | No                |                                                                                                                                                                                                                                                                                                                        |
| 17    | \* ensuring users with multiple accounts/credential signins are actually the same person —- requesting linking IDs                                                                         |                                                                                                                                                                   | Yes          | \* credentials should be re-randomized always                                                                                                                                                                                                                                                                                   | Yes               | \* "request the identified EUDI Wallet User to identify with another eID means which is accepted by the Relying Party so to link the data received from the EUDI Wallet with the account to which the User proved to have access to" → further supports need for efficient re-randomization                            |
| 18    | _ user presenting info/proofs across multiple credentials<br>_ shall request proof-of-association of PKs each credential is issued to from the WCSA/WCSD                                   | found a schnorr-style ZKP for association between PKs https://eprint.iacr.org/2024/1444.pdf<br><br>main idea: proof of knowledge of dlog relationship btw the two | Yes          | _ proof-of-association should not have PKs in plaintext to the verifier (otherwise provides linkability)<br>_ need wallet user to do process proof received directly from WSCA<br>\* we propose an in-circuit verification of the ZKP received from WSCA (as a recursive proof) + matching of PKs to the ones in the credential | Yes               | <<<                                                                                                                                                                                                                                                                                                                    |
| 19    | must have overview of all transactions executed through the Wallet Instance that cannot be deleted….                                                                                       |                                                                                                                                                                   | No           |                                                                                                                                                                                                                                                                                                                                 | Yes               | _ need to ensure this is hidden behind some kind of biometric authentication within the wallet, so that cannot be accessed if stolen<br>_ access to this data allows linkage everywhere.<br>\* definitely should not be external                                                                                       |
| 20    | ID verification should be strict to prevent fraud                                                                                                                                          | no HLRs                                                                                                                                                           | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 21    |                                                                                                                                                                                            | no HLRs                                                                                                                                                           | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 22    |                                                                                                                                                                                            | no HLRs                                                                                                                                                           | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 23    |                                                                                                                                                                                            | no new HLRs                                                                                                                                                       | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 24    | UX flows for proximity (e.g. mDL) - including user approval for disclosure                                                                                                                 | just UX stuff                                                                                                                                                     | No           |                                                                                                                                                                                                                                                                                                                                 | No                |                                                                                                                                                                                                                                                                                                                        |
| 25    | similar to topic 12, standardizing vocab for attestation attributes                                                                                                                        | issuer responsibility                                                                                                                                             | No           |                                                                                                                                                                                                                                                                                                                                 | No                |                                                                                                                                                                                                                                                                                                                        |
| 26    | for these standards, anyone can contribute, just be reasonable                                                                                                                             | issuer/standards responsibility                                                                                                                                   | No           |                                                                                                                                                                                                                                                                                                                                 | No                |                                                                                                                                                                                                                                                                                                                        |
| 27    | relying party should get certificates to be verified by the wallet user before disclosure                                                                                                  | relying party + trusted anchor responsibility                                                                                                                     | No           |                                                                                                                                                                                                                                                                                                                                 | No                |                                                                                                                                                                                                                                                                                                                        |
| 28    | wallet for legal person (e.g. corps, governemnts, and and NGOs) should be diff from natural person (human)                                                                                 | issuer responsibility                                                                                                                                             | No           |                                                                                                                                                                                                                                                                                                                                 | No                |                                                                                                                                                                                                                                                                                                                        |
| 29    | should allow for issuance of eIDs that let someone represent someone else. not speced out yet, ad-hoc                                                                                      | unclear                                                                                                                                                           | Maybe        | _ we propose including both entities' PKs in the credential where transaction log would show up in represented person's asw<br>_ maybe phone home to person being represented is OK?                                                                                                                                            | Maybe             | <<<                                                                                                                                                                                                                                                                                                                    |
| 30    | wallet user can also be verifier                                                                                                                                                           | nothing new                                                                                                                                                       | No           |                                                                                                                                                                                                                                                                                                                                 | No                |                                                                                                                                                                                                                                                                                                                        |
| 31    | public, no-auth trusted list of certificate issuers (for issuers, wallet providers, and relying parties)                                                                                   | nothing concerning! public list is good                                                                                                                           | No           |                                                                                                                                                                                                                                                                                                                                 | No                |                                                                                                                                                                                                                                                                                                                        |
| 32    | PID interop                                                                                                                                                                                | no HLRs                                                                                                                                                           | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 33    | backup devices (e.g. HSM backups)                                                                                                                                                          |                                                                                                                                                                   | No           |                                                                                                                                                                                                                                                                                                                                 | Yes               | how do HSM backups work? how to ensure they are secure so that credentials aren't stolen                                                                                                                                                                                                                               |
| 34    | transfer to diff wallet                                                                                                                                                                    | no HLRs                                                                                                                                                           | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 35    | protocol for PID issuance                                                                                                                                                                  | yes                                                                                                                                                               | Yes          | see privacy concerns around wallet user providing WTE for PID/attestation issuer to verify before credential issuance                                                                                                                                                                                                           | Yes               | \* in the cases that the issuer is just another verifier or EUDI wallet instance (user) — want WTE verification to be private (especially for credential issuances that don't require sensitive info/verification) for unlinkability                                                                                   |
| 36    | risk analysis                                                                                                                                                                              | no HLRs                                                                                                                                                           | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 37    | remote signing                                                                                                                                                                             | no HLRs                                                                                                                                                           | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 38    | _ need to ensure use of wallet instance attestations (WIA) to relying parties -/→ tracking<br>_ wallets must revoke/suspend when PID issuer asks                                           |                                                                                                                                                                   | Yes          |                                                                                                                                                                                                                                                                                                                                 | Yes               | _ if WIAs are a separate list and just a static watermark, then can do merkle inclusion proof for unlinkability<br>_ we recommend against publishing list of public keys as a WIA mechanism — since this causes device-binding to function as doxxing (can check signatures against each of the potential public keys) |
| 39    | wallet to wallet technical topic                                                                                                                                                           | no HLRs                                                                                                                                                           | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 40    | reserved                                                                                                                                                                                   | no HLRs                                                                                                                                                           | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 41    | min reqs on PuB-EAAs rulebooks                                                                                                                                                             | no HLRs                                                                                                                                                           | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 42    | qualified trust service proveirs (qtsps)(issuers of QEAA attestation types) need access to authentic souces (e.g. databases of legal citizens)                                             |                                                                                                                                                                   | No           |                                                                                                                                                                                                                                                                                                                                 | No                |                                                                                                                                                                                                                                                                                                                        |
| 43    | policy for which items to be disclosed in certain presentation situations                                                                                                                  |                                                                                                                                                                   | No           | needs to be built into the frontend logic before circuit proofs on the user side.                                                                                                                                                                                                                                               | Maybe             | only if some metadata about Wallet (that would provide linkability) can be tracked when requesting info from relying party…                                                                                                                                                                                            |
| 44    | QEAA eval reqs                                                                                                                                                                             | deleted                                                                                                                                                           | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 45    | QEAA rulebook                                                                                                                                                                              | no new HLRs                                                                                                                                                       | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 46    | protocol of cred presentation w verifiers                                                                                                                                                  | no HLRs                                                                                                                                                           | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 47    | ^ including non-QEAAs                                                                                                                                                                      | no HLRs                                                                                                                                                           | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 48    | users being able to delete presented data to verifiers                                                                                                                                     |                                                                                                                                                                   | No           |                                                                                                                                                                                                                                                                                                                                 | Yes               | good!                                                                                                                                                                                                                                                                                                                  |
| 49    | protocols for 48                                                                                                                                                                           | deleted                                                                                                                                                           | N/A          |                                                                                                                                                                                                                                                                                                                                 | N/A               |                                                                                                                                                                                                                                                                                                                        |
| 50    | protocols for reporting relying party abuse                                                                                                                                                | [?] isn't relying party certificate + checking against trusted anchor list enough?                                                                                | No           |                                                                                                                                                                                                                                                                                                                                 | No                |                                                                                                                                                                                                                                                                                                                        |

---

## References

- [EUDI Architecture and Reference Framework](https://eu-digital-identity-wallet.github.io/eudi-doc-architecture-and-reference-framework/)
- [EUDI ARF Annex 2 - High Level Requirements](https://eu-digital-identity-wallet.github.io/eudi-doc-architecture-and-reference-framework/1.4.0/annexes/annex-2/annex-2-high-level-requirements/)
- [OpenID for Verifiable Presentations](https://openid.net/specs/openid-4-verifiable-presentations-1_0.html)
- [ISO/IEC 18013-5:2021 - mDL Standard](https://www.iso.org/standard/69084.html)
- [Schnorr-style ZKP for Key Association](https://eprint.iacr.org/2024/1444.pdf)
- [Microsoft Crescent Credentials](https://github.com/microsoft/crescent-credentials)
